# Homework - [Lecture 5] - DevSecOps

Первым делом, поскольку не могу использовать shared раннеры, придется зарегистрировать локальный раннер. Для этого буду использовать Ubuntu в VB, при регистрации задаю executer docker, default image взял ubuntu:latest. Можно было через shell, ставить тулзы standalone, но так выходит проще, поэтому работаем с образами.

Ссылка на BenchmarkJava: https://gitlab.com/xokage/BenchmarkJava/-/tree/master

Ссылка на security-pipeline:
https://gitlab.com/xokage/security-pipeline

## Gitleaks

Поиск секретов в глубину. В данном репозитории порядка 473 коммитов, почему то долго сканится. В итоге, я полностью отсканил репозиторий с дефолтными правилами, можно по идее дописать toml файл и найти больше. Вышло 3 уязвимости, первые две - это мои коммиты с RSA ключом. И один я нашел токен от Sonar Qube.


![](https://i.imgur.com/x3qYxCI.png)


Для визуализации+распарсить отчет, чтобы можно было комфортно исследовать, использовал DD. Создал енгейдж и импотнул туда json.

![](https://i.imgur.com/89Z29sK.png)


![](https://i.imgur.com/IUxI9a9.png)

В конце можно будет приложить полный отчет по всем инструментам.

Правда если сравнивать хэш коммита, то по нему не находится. Токен был захардкожен в другом коммите:

![](https://i.imgur.com/plHJSMk.png)

Предыдущие версии гитликса отдавали сразу ссылку в отчете.

## Dependency Check

Здесь все достаточно просто, единственное я выгрузил два отчета, один html, другой xml для Defect Dojo.

Отчет показывает 3 Средних уязвимости:

![](https://i.imgur.com/FMeLQZR.png)

Также закину в DefectDojo для общего отчета.

14 cve было найдено:

![](https://i.imgur.com/OJSDPfo.png)

Часть лога:

![](https://i.imgur.com/ll8acyV.png)


Впринципе можно создавать енгейджы и выгружать отчеты в DD через API, встроить в общий скрипт.

## Semgrep SAST

Здесь нужно найти наилучший по результам находок набор правил.
Золотую середину пришлось искать долго, путем перебора всех доступных наборов правил. Вышел вот такой список:

FROM Repository:
r2c-best-practices 9
ci 289
jwt  0
r2c 1071
xss 1721
test 0
java 3747
nginx 0
docker 3
r2c-ci 42 слабый DES алгоритм
default 5645
mobsfscan 1473
r2c-bug-scan 7
owasp-top-ten 3847
sql-injection 178
security-audit 3790
command-injection 1 небезопасная рефлексия
r2c-security-audit 3790
insecure-transport 1 используется версия TLSv1
R:
r/java.lang 3969
...

Можно брать просто правила по отдельности, но это очень долго, в наборах те же правила. Лучше всего конечно написать самому правила, что тоже очень долго. Делая вывод из таблицы выше, берем нужные правила в одну строку скрипта.


![](https://i.imgur.com/Xfq1CcS.png)


Вышло 56 штук, 2 DD посчитал за дупликаты:

![](https://i.imgur.com/2xSSVyt.png)


## Kics

Здесь все достаточно просто. Запускаем образ в контейнере, указываем папку с исходниками и куда выгружать отчет. Отчет я выбрал типа json, чтобы скормить DefectDojo.

![](https://i.imgur.com/79GhXsm.png)

В DD:

Kics нашел очень много уязвимостей, даже DD не смог столько распарсить, а только добавил в очередь. Понятно, что здесь тоже нужно что то придумать с правилами.


![](https://i.imgur.com/VH56t8o.png)


Еще попробовал прикрутить для поиска секретов в глубину trufflehog, но он очень медленный и находит много уязвимостей, тут тоже надо писать правила под него.

Отчет из ДД приложу в репозиторий гитхаба.